#!/bin/bash

clear

mkdir scanned_domains
cd scanned_domains

echo -e "\e[1;33mEnter the domain to test\e[00m" ""
read -ep "> " domain
echo -e "\e[1;33m----------------------------------------\e[00m"

if [ -z $domain ]; then
     echo "----------------------------------------"
     echo "Invalid choice."
     echo "----------------------------------------"
     exit
fi

mkdir "$domain"_pen_test
cd "$domain"_pen_test
clear

	echo -e "\e[1;33m----------------------------------------\e[00m"
	echo -e "\e[1;33mRetrieving Information\e[00m"
	echo ""
		
		whatweb http://$domain | tee "$domain"_info.txt


	echo -e "Output has been saved in \e[00;32m"$domain"_info.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"


	echo -e "\e[1;33m----------------------------------------\e[00m"
	echo -e "\e[1;33mGetting all subdomains of the given domain\e[00m"
	echo ""
		
		nslookup -type=NS $domain | grep "nameserver" | awk '{print $4}' | tee "$domain"_subdomains.txt

	echo -e "Output has been saved in \e[00;32m"$domain"_subdomains.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"

	echo -e "\e[1;33m----------------------------------------\e[00m"
	echo -e "\e[1;33mGetting IP adresses of the subdomains\e[00m"
	echo ""

	for x in $(cat "$domain"_subdomains.txt); do
	     host $x | grep 'has address' | cut -d ' ' -f1,4 >> tmp
	done

		column -t tmp | sort -u |tee "$domain"_sub_IPs.txt

	rm tmp

	echo -e "Output has been saved in \e[00;32m"$domain"_subdomains.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"


	echo -e "\e[1;33mRetrieving dns informations and performing zone transfers\e[00m"
	echo ""
	echo -e "\e[1;33m----------------------------------------\e[00m"

		dnsrecon -d $domain -t axfr --xml "$domain"_zone_transfer

	echo -e "Output has been saved in \e[00;32m"$domain"_zone_transfer.xml\e[00m."
	echo
	

	echo -e "\e[1;33mPerforming whois lookup and retrieving Netcraft information using dmitry\e[00m"
	echo ""

		dmitry -wino "$domain"_whois_lookup.txt $domain

	echo -e "Output has been saved in \e[00;32m"$domain"_whois_lookup.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"


	echo -e "\e[1;33mRetrieving subdomains and email addresses using theHarvester\e[00m"
	echo ""

		theharvester -d $domain -l 300 -b all -f "$domain"_information

	
	echo -e "Output has been saved in \e[00;32m"$domain"_information.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"


	echo -e "\e[1;33mBuilding Custom Dictionary from the website\e[00m"
	echo ""

		gnome-terminal --tab -e "/bin/bash -c 'cewl -d 2 -m 5 -w "$domain"_dictionary.txt www."$domain" -v; exec /bin/bash -i'"
	
	echo -e "Output has been saved in \e[00;32m"$domain"_dictionary.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"


	echo -e "\e[1;33mEnumerate domains and subdomains for directories and files \e[00m"
	echo ""

	echo -e "\e[1;33m----------------------------------------\e[00m"
	echo -e "\e[1;33mDetecting Web Application Firewall\e[00m"
	echo ""
		
		wafw00f http://$domain | tee "$domain"_firewall.txt


	echo -e "Output has been saved in \e[00;32m"$domain"_firewall.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"
	
	
	echo -e "\e[1;32mPlease enter the wordlist you want to use?  \e[00m"
	echo -e " apache \n frontpage \n iis \n oracle \n sap \n sharepoint \n tomcat"
	read -p "> " wordlist

		gnome-terminal --tab -e "/bin/bash -c 'dirb http://www."$domain" /usr/share/dirb/wordlists/vulns/"$wordlist".txt -o "$domain"_directories.txt; exec /bin/bash -i'"
	
	echo -e "Output has been saved in \e[00;32m"$domain"_directories.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"

	echo -e "\e[1;32mConducting automatic vulnerability assessment  \e[00m"
	
		bash ../../auto_assess.sh www."$domain" | tee "$domain"_vuln_assess.txt
	
	echo -e "Output has been saved in \e[00;32m"$domain"_vuln_assess.txt\e[00m."
	echo
	echo -e "\e[1;33m----------------------------------------\e[00m"
	

	cd ../..

echo
echo
