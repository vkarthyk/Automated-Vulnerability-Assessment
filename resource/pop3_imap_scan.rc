resource portscan.rc > /dev/null

	<ruby>
	framework.db.hosts.each do |host|
	  host.services.each do |service|
	    if service.port == "110" or service.port == "143" and service.state == "open"
	      self.run_single("set RHOSTS #{host.address}")
	      self.run_single("set RPORT #{service.port}")
	      self.run_single('run')

		run_single("db_nmap -p110 -sV --script=pop3-brute --script-args safe=1 #{framework.datastore['RHOSTS']}")
		puts
		run_single("db_nmap -p143,993 --script imap-brute #{framework.datastore['RHOSTS']}")
		puts
		run_single("db_nmap -p445 --script=smb-enum-shares #{framework.datastore['RHOSTS']}")
		puts
		run_single("db_nmap -p445 -v --script=smb-brute #{framework.datastore['RHOSTS']}")
		puts
	
		run_single("vulns #{framework.datastore['RHOSTS']}")
	
	    end
	  end
	end
	
	</ruby>

	use auxiliary/scanner/pop3/pop3_version
	run
	echo

	use auxiliary/scanner/pop3/pop3_login
	run
	echo

	use auxiliary/scanner/imap/imap_version
	run
	echo

	

